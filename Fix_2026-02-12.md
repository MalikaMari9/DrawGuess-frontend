# Fix_2026-02-12.md

## Summary
Integrated backend connection flow (WebSocket) up to lobby for the new UI and disabled the old create-room screens.

## Frontend Changes
- Added shared WS context provider to reuse a single WebSocket connection across routes.
- Landing page now supports:
  - nickname entry
  - join by room code (connects, sends join, requests snapshot)
- Mode select now:
  - creates room via WebSocket
  - auto-joins on `room_created`
  - routes directly to lobby
- Single and Battle lobby pages now use live snapshot data:
  - room code
  - player list
  - team list (VS)
- Disabled `SingleCreateRoom` and `BattleCreateRoom` pages (kept for future use).
- Added join-row UI styles for landing page.

## Files Updated / Added
- DrawGuessFrontend/src/ws/RoomWSContext.jsx
- DrawGuessFrontend/src/App.jsx
- DrawGuessFrontend/src/pages/landingpage.jsx
- DrawGuessFrontend/src/pages/SelectMode.jsx
- DrawGuessFrontend/src/pages/SingleLobby.jsx
- DrawGuessFrontend/src/pages/BattleLobby.jsx
- DrawGuessFrontend/src/pages/SingleCreateRoom.jsx
- DrawGuessFrontend/src/pages/BattleCreateRoom.jsx
- DrawGuessFrontend/src/styles/landingpage.css

## Notes
- Backend integration stops at lobby per request.
- Room code is auto-generated by backend; UI no longer uses manual create room forms.

## Additional Fixes
- Removed duplicate React import in landing page.
- Moved Google Fonts @import statements from component CSS files to src/index.css (Vite requires @import at top).
- Removed duplicate inline style key in BattleRoundWin.jsx.

## Additional Fixes (Lobby)
- Added auto-reconnect on refresh using saved room/pid and `reconnect`.
- Added snapshot refresh on player join/leave and team updates.
- Added copy room code button to Single and Battle lobbies.

## Additional Fixes (WS Create Endpoint)
- Added backend WebSocket endpoint `/ws-create` for room creation only.
- Frontend now uses `/ws-create` to create rooms before connecting to `/ws/{room_code}`.

## Additional Fixes (Select Mode)
- Added missing React hook imports in SelectMode.
- After ws-create, navigate directly to lobby and clear creating state (removed stale room_created effect).

## Additional Fixes (Start Role Pick)
- Lobby start button enabled at 3 players (Single) and 5 players (VS).
- Start role pick is now available to any player (no GM requirement).

## Additional Fixes (Debug)
- Added WS debug line (status + last message) in Single and Battle lobbies.

## Additional Fixes (Debug Panel)
- Added send-ok + last error panel to Single and Battle lobbies for start-role-pick debugging.

## Additional Fixes (Role Pick + Waiting Room)
- Added RolePick screen with lottery wheel animation.
- Added WaitingRoom with GM config + countdown and role-based views.
- Lobby now navigates to RolePick on ROLE_PICK (Single) or CONFIG (VS).

## Additional Fixes (Role Pick Timing)
- Improved role pick animation and added 10s countdown before moving to waiting room.

## Additional Fixes (Role Pick Sync)
- Backend now sends role-pick events to sender as well as room to keep all clients in sync.

## Additional Fixes (Waiting Room Countdown)
- Added 5s secret reveal window before a 10s countdown.
- Non-GM clients sync config start when secret_word appears.

## Additional Fixes (Countdown Start Delay)
- Delayed start_game/start_round until after 5s reveal + 10s countdown.

## Additional Fixes (Admin Panel)
- Added admin endpoints to list rooms and force-close rooms.
- Added `/admin` UI to view rooms and close them.

## Additional Fixes (VS Waiting Room)
- Removed VS `set_round_config` call; VS now only sends `start_round` after reveal + countdown.
- Added missing React hooks import in WaitingRoom.

## Additional Fixes (VS Auto Team)
- Reverted: VS team assignment no longer happens on join.
- VS lobby now matches Single lobby layout (with VS styling) and keeps hourglass waiting UI.

## Additional Fixes (VS Role Pick Teams)
- RolePick now shows VS team layout (red/blue) using team assignments after start.
- Added team fallback using role suffix (A/B) and snapshot refresh on RolePick load.

## Additional Fixes (VS Test Mode)
- Removed VS Test Mode toggles and simulated players.

## Additional Fixes (Scroll)
- Replaced `overflow: hidden` with vertical scroll + hidden horizontal in frontend CSS to allow page scrolling.
